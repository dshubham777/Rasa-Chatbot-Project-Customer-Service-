(this["webpackJsonprasa-frontend"]=this["webpackJsonprasa-frontend"]||[]).push([[5],{1598:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return K}));var n=r(0),a=r.n(n),l=r(80),o=r(20),c=r(23),s=r(66),i=r(3),u=r(100),m=r(43),f=r(1),d=r(9),E=r(30),h=r(65),v=r(139),b=r(28);function p(e){var t=e.roles,r=e.roleUsers,a=e.total,l=e.onLoadMoreRows,o=e.onEdit,c=e.onDelete,s=n.useCallback((function(e){var t=e.dataSelected,a=e.setSelected,l=t.filter((function(e){return(r[e.role]||[]).length>0})).length;return n.createElement(f.Box,null,n.createElement(E.a,{resource:d.c.Roles,action:d.a.Delete,yes:n.createElement(b.a,{content:l>0?"Cannot perform delete because ".concat(1===l?"the selected role still has":"".concat(l," selected roles still have")," users assigned"):"Delete"},n.createElement(i.a,{variant:"inverse",disabled:l>0,onClick:function(){c(t),a([])}},"Delete"))}))}),[c,r]),u=n.useCallback((function(e){var t=e.selected,r=e.onChangeSelected;return function(e){var a=e.rowIndex,l=e.rowData,o=t.includes(a);return n.createElement(f.Flex,null,n.createElement(f.Box,{flex:"0 1 auto"},n.createElement("label",null,n.createElement(h.a,{checked:o,onChange:function(){return r(a,!o)}}))),n.createElement(f.Box,{ml:3,flex:"1"},n.createElement(i.f,{variant:"bodySecondary"},l.role)))}}),[]),p=n.useCallback((function(){return function(e){var t=e.rowData;if(!t)return null;var a=r[t.role]||[];return n.createElement(f.Flex,{flexDirection:"row-reverse",mr:-1},n.createElement(E.a,{resource:d.c.Roles,action:d.a.Delete,yes:0===a.length?n.createElement(b.a,{content:"Delete"},n.createElement(i.a,{mx:1,onClick:function(){c([t])},variant:"icon"},n.createElement(i.c,{icon:"trash-alt"}))):n.createElement(f.Box,{mx:1,flex:"0 0 40px"})}),n.createElement(E.a,{resource:d.c.Roles,action:d.a.Update,yes:n.createElement(b.a,{content:"Edit"},n.createElement(i.a,{mx:1,onClick:function(){o(t)},variant:"icon"},n.createElement(i.c,{icon:"edit"})))}))}}),[r,o,c]);return n.createElement(v.a,{total:a,bulkActionsRenderer:s,data:t,resource:d.c.Roles,onLoadMoreRows:l},(function(e){return[n.createElement(m.d,{key:"role",cellDataGetter:function(){},flexGrow:2,width:2/6,dataKey:"role",label:"Role",cellRenderer:u(e)}),n.createElement(m.d,{key:"description",cellDataGetter:function(){},flexGrow:3,width:2/6,dataKey:"role",label:"Description",cellRenderer:function(e){var t=e.rowData;return n.createElement(i.f,{variant:"bodySecondary"},t.description||"No description")}}),n.createElement(m.d,{key:"users",cellDataGetter:function(){},flexGrow:3,width:1/6,dataKey:"role",label:"Users",cellRenderer:function(e){var t=e.rowData,a=r[t.role]||[];return 0===a.length?n.createElement(i.f,{variant:"bodySecondary"},"No users currently have this role"):a.length<3?n.createElement(i.f,{variant:"bodySecondary"},a.map((function(e){return e.username})).join(" and ")):n.createElement(i.f,{variant:"bodySecondary"},a.slice(0,2).map((function(e){return e.username})).join(", "),n.createElement("b",null," +",a.length-2," more"))}}),n.createElement(m.d,{key:"role",cellDataGetter:function(){},flexGrow:1,width:1/6,dataKey:"role",label:"",cellRenderer:p()})]}))}function x(e){var t=e.roleUsers,r=e.roles,a=e.total,o=e.onLoadMoreRows,c=e.onDeleteRole,s=Object(l.g)().push,m=n.useCallback((function(e){return s("/roles/".concat(e.role))}),[s]);return n.useEffect((function(){o({search:"",offset:0,limit:0})}),[o]),n.createElement(u.a,{title:"Roles",rightContent:n.createElement(i.a,{variant:"primary",large:!0,onClick:function(){return s("/roles/create")},mr:4},"Create new role")},n.createElement(p,{roleUsers:t,roles:r,total:a,onLoadMoreRows:o,onEdit:m,onDelete:c}))}var g={onFetchRoles:s.d.request,onDeleteRole:s.a.request};var y=Object(o.b)((function(e){return{roles:e.roles.roles,roleUsers:e.roles.roleUsers,userRole:e.auth.role,total:e.roles.total}}),g)((function(e){var t=Object(c.e)(s.d);return n.createElement(x,Object.assign({},e,{onLoadMoreRows:t}))})),w=r(18),R=r(57),C=r(6),U=r(7),k=r(664),j=r(426),D=r(24);function O(e){return a.a.createElement(i.a,Object.assign({variant:"icon",color:"neutral_8"},e),a.a.createElement(i.c,{icon:["fas","arrow-left"]}))}var F,S=r(35),B=r(98),M=r(14);function q(e,t){return[].concat(Object(M.a)(e?["read:any"]:[]),Object(M.a)(t?["create:any","update:any","delete:any"]:[]))}function G(e){var t=e.value,r=e.permission,a=e.onChange,l=t.includes("read:any"),o=t.includes("create:any");return n.createElement(f.Flex,{py:3},n.createElement(f.Box,{flex:4,width:4/6},n.createElement(i.f,null,r.label)),n.createElement(f.Box,{flex:1,width:1/6},!r.cannotView&&n.createElement("label",null,n.createElement(h.a,{checked:l,onChange:function(){return a(q(!l,o))}}))),n.createElement(f.Box,{flex:1,width:1/6},!r.cannotModify&&n.createElement("label",null,n.createElement(h.a,{checked:o,onChange:function(){return a(q(l,!o))}}))))}function A(e){var t=e.value,r=e.onChange,a=e.permissions;return n.createElement(f.Box,null,n.createElement(f.Flex,{py:3},n.createElement(f.Box,{flex:4,width:4/6},n.createElement(D.a,{variant:3},"Permissions")),n.createElement(f.Box,{flex:1,width:1/6},n.createElement(D.a,{variant:3},"View")),n.createElement(f.Box,{flex:1,width:1/6},n.createElement(D.a,{variant:3},"Modify"))),a.map((function(e){return n.createElement(G,{key:e.resource,permission:e,value:t[e.resource]||[],onChange:function(n){return r(Object(C.a)({},t,{[e.resource]:n}))}})})))}!function(e){e[e.Permissions=0]="Permissions",e[e.Users=1]="Users"}(F||(F={}));var P={role:"",description:"",is_default:!1,grants:{}};function L(e){var t=e.users,r=e.role,a=e.roleUsers,o=void 0===a?[]:a,c=e.onSaveRole,s=e.onUpdateRole,m=e.onFetchUsers,d=e.permissions,E=Object(l.g)().push;n.useEffect((function(){m({search:"",limit:0,offset:0})}),[m]);var v=n.useState(r||P),b=Object(U.a)(v,2),p=b[0],x=b[1];n.useEffect((function(){r&&x(r)}),[r]);var g=n.useCallback((function(e){return x(Object(C.a)({},p,{},e))}),[p]),y=n.useState([]),w=Object(U.a)(y,2),R=w[0],M=w[1];n.useEffect((function(){o&&M(o.map((function(e){return{label:e.username,value:e.username,data:e}})))}),[o,o.length]);var q=n.useState(F.Users),G=Object(U.a)(q,2),L=G[0],N=G[1],_=n.useMemo((function(){return Object.values(t).map((function(e){return{label:e.username,value:e.username,data:e}}))}),[t]);return n.createElement(u.a,{scrollable:!0,title:n.createElement(n.Fragment,null,n.createElement(O,{onClick:function(){return E("/roles")}})," ",r?"Edit":"Create new"," Role"),rightContent:n.createElement(f.Flex,{mr:-2,pr:4,flexDirection:"row-reverse"},n.createElement(i.a,{variant:"primary",onClick:function(){var e=R.map((function(e){return e.data}));r?s({currentId:r.role,role:p,users:e}):c({role:p,users:e}),E("/roles")},large:!0,mr:2},r?"Save":"Create"," role"),n.createElement(i.a,{variant:"secondary",onClick:function(){return E("/roles")},large:!0,mr:2},r?"Cancel":"Discard"))},n.createElement(f.Box,{width:2/3,m:"0 auto"},n.createElement(i.b,{sx:{borderRadius:"large"},p:6,mb:6},n.createElement(D.a,{variant:2,mb:4},"Basic Details"),n.createElement(f.Box,{mb:4,width:"100%"},n.createElement(B.a,{text:"Name"},n.createElement(S.a,{value:p.role,onChangeValue:function(e){return g({role:e})},fullWidth:!0,placeholder:"Role title",autoFocus:!0}))),n.createElement(f.Box,{mb:4,width:"100%"},n.createElement(B.a,{text:"Description"},n.createElement(S.a,{value:p.description||"",onChangeValue:function(e){return g({description:e})},fullWidth:!0,placeholder:"Access chat logs, analyze and define requirements for updates"}))),n.createElement(f.Flex,{as:"label",alignItems:"center"},n.createElement(h.a,{checked:p.is_default||!1,onChange:function(e){return g({is_default:!p.is_default})},mr:2}),n.createElement(i.f,null,"Set as default roles"))),n.createElement(i.b,{sx:{borderRadius:"large"},p:6},n.createElement(k.a,{justifyContent:"flex-start",ml:-3,mb:4},n.createElement(j.a,{variant:2,active:L===F.Permissions,onClick:function(){return N(F.Permissions)}},"Add Permissions"),n.createElement(j.a,{variant:2,active:L===F.Users,onClick:function(){return N(F.Users)}},"Add Users")),L===F.Permissions&&n.createElement(A,{permissions:d,value:p.grants,onChange:function(e){return g({grants:e})}}),L===F.Users&&n.createElement(B.a,{text:"Add users to this Role"},n.createElement(i.e,{isMulti:!0,placeholder:"Search users...",options:_,value:R,onChange:function(e){return Array.isArray(e)&&M(e)},hideSelectedOptions:!1})))))}var N={onSaveRole:s.f.request,onUpdateRole:s.g.request,onFetchUsers:R.d.request,onFetchRole:s.b.request,onFetchRoleUsers:s.c.request};var _=Object(o.b)((function(e){return{users:e.users.users,permissions:e.roles.permissions,roles:e.roles.roles,roleUsers:e.roles.roleUsers}}),N)((function(e){var t=e.roles,r=e.roleUsers,a=e.onFetchRoleUsers,o=e.onFetchRole,c=Object(w.a)(e,["roles","roleUsers","onFetchRoleUsers","onFetchRole"]),s=Object(l.i)().params.roleName;n.useEffect((function(){s&&(o(s),a(s))}),[o,a,s]);var i=n.useMemo((function(){if(s)return Object.values(t).find((function(e){return e.role===s}))}),[s,t]),u=n.useMemo((function(){return s?r[s]:[]}),[s,r]);return n.createElement(n.Fragment,null,n.createElement(L,Object.assign({role:i,roleUsers:u},c)))}));function K(e){var t=Object(c.g)();n.useEffect((function(){t("view:roles:loaded")}),[t]);var r=Object(l.i)();return n.createElement(l.e,null,n.createElement(l.c,{exact:!0,path:r.path,component:y}),n.createElement(l.c,{exact:!0,path:"".concat(r.path,"/create"),component:_}),n.createElement(l.c,{exact:!0,path:"".concat(r.path,"/:roleName"),component:_}))}}}]);